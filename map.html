<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <style>
    html, body, #map { width: 100%; height: 100%; margin: 0; }
  </style>
</head>
<body>
<div id="map"></div>
<script>
  let map, center;
  const params = new URLSearchParams(window.location.search);
  const lat = parseFloat(params.get('lat')) || 35.58023;
  const lng = parseFloat(params.get('lng')) || 139.52378;

  function initMap() {
    center = { lat, lng };
    map = new google.maps.Map(document.getElementById("map"), {
      zoom: 16, center, mapTypeId: "satellite"
    });

    // 1. 标注目标位置 (绿色大圆)
    new google.maps.Marker({
      position: center, map,
      icon: { path: google.maps.SymbolPath.CIRCLE, scale: 10, fillColor: "#006400", fillOpacity: 1, strokeColor: "#fff", strokeWeight: 2 }
    });

    // 2. 搜索并标注最近 4 个车站 (蓝色大圆)
    const service = new google.maps.places.PlacesService(map);
    service.nearbySearch({ location: center, radius: 2500, type: "train_station" }, (results, status) => {
      if (status === "OK") {
        results.slice(0, 4).forEach(place => {
          const marker = new google.maps.Marker({
            position: place.geometry.location, map,
            icon: { path: google.maps.SymbolPath.CIRCLE, scale: 9, fillColor: "#1E90FF", fillOpacity: 1, strokeColor: "#fff", strokeWeight: 2 }
          });
          
          // 计算步行时间并绑定点击事件
          const matrix = new google.maps.DistanceMatrixService();
          matrix.getDistanceMatrix({
            origins: [center], destinations: [place.geometry.location],
            travelMode: 'WALKING'
          }, (resp, stat) => {
            if (stat === "OK") {
              const res = resp.rows[0].elements[0];
              const info = new google.maps.InfoWindow({
                content: `<strong>${place.name}</strong><br>距离: ${res.distance.text}<br>步行: ${res.duration.text}`
              });
              marker.addListener("click", () => info.open(map, marker));
            }
          });
        });
      }
    });
  }
</script>
<script async src="https://maps.googleapis.com/maps/api/js?key=你的_Key&libraries=places&language=ja&callback=initMap"></script>
</body>
</html>